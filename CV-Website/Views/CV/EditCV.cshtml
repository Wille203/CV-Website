@model CV_Website.ViewModels.CVViewModel
@{
    var S = Model.SelectedSkills;
    var E = Model.SelectedExperiences;
    var Ed = Model.AllEducations;
}

<form asp-action="EditCV" method="post">
	<input type="hidden" asp-for="UserId" />

	<div class="form-item">
	    <h4>Uppdatera ditt CV</h4>

        <div class="f-i1">
            <h4>Färdigheter</h4>
        @if (Model.AllSkills != null && Model.AllSkills.Any())
        {
            <ul>
                @foreach (var skill in Model.AllSkills)
                {
                    <li>
                            <input type="checkbox" name="SelectedSkills" value="@skill.SkillsId" onchange= "SearchCV(this.value, this.checked)"
                        @(Model.SelectedSkills != null && Model.SelectedSkills.Contains(skill.SkillsId) ? "checked" : "") />
                        @skill.Name
                    </li>
                }
            </ul>
        }
        </div>

        <div class="f-i2">
        <h4>Utbildning</h4>
        @if (Model.AllEducations != null && Model.AllEducations.Any())
        {
            <ul>
                @foreach (var education in Model.AllEducations)
                {
                    <li>
                            <input type="checkbox" name="SelectedEducations" value="@education.EducationId" onchange=" SearchCV(this.value, this.checked)"
                        @(Model.SelectedEducations != null && Model.SelectedEducations.Contains(education.EducationId) ? "checked" : "") />
                        @education.Name
                    </li>
                }
            </ul>
        }
        </div>

        <div class="f-i3">
        <h4>Erfarenheter</h4>
        @if (Model.AllExperiences != null && Model.AllExperiences.Any())
        {
            <ul>
                @foreach (var experience in Model.AllExperiences)
                {
                    <li>
                            <input type="checkbox" name="SelectedExperiences" value="@experience.ExperienceId" onchange="SearchCV(this.value, this.checked)"
                            @(Model.SelectedExperiences != null && Model.SelectedExperiences.Contains(experience.ExperienceId) ? "checked" : "") />
                        @experience.Name
                    </li>
                }
            </ul>
        }
        </div>

        <button type="submit" class="btn btn-primary">Spara ändringar</button>
        <a href=@Url.Action("GoToUserPage", "User", new { userId = ViewBag.CurrentUserId}) class="btn btn-secondary">Avbryt</a>
    </div>
</form>

<div class="f-i3">
    <h4>Erfarenheter</h4>
    @if (Model.AllExperiences != null && Model.AllExperiences.Any())
    {
        <ul>
            @foreach (var Experience in E)
            {
                <li>
                   @Experience
                </li>
            }
        </ul>
    }
</div>

<div class="f-i3" id="SS">
    <h4>Färdigheter</h4>
    @if (Model.SelectedSkills != null && Model.SelectedSkills.Any())
    {
        <ul>
            @foreach (var skillName in Model.AllSkills.Where(s => Model.SelectedSkills.Contains(s.SkillsId)).Select(s => s.Name))
            {
                <li id="SS2">
                    @skillName
                </li>
            }
        </ul>
    }
</div>

<script>
    function SearchCV(skillId, isChecked) {
        var selectedSkillsList = document.getElementById("SS");
        var skillName = document.querySelector(`input[value='${skillId}']`).nextSibling.textContent.trim();

        // Hitta listan med valda färdigheter
        var skillListItems = selectedSkillsList.querySelectorAll("li");

        if (isChecked) {
            // Lägg till den valda färdigheten
            var newListItem = document.createElement("li");
            newListItem.textContent = skillName;
            newListItem.id = `SS2-${skillId}`;
            selectedSkillsList.appendChild(newListItem);
        } else {
            // Ta bort den avmarkerade färdigheten
            var itemToRemove = document.getElementById(`SS2-${skillId}`);
            if (itemToRemove) {
                selectedSkillsList.removeChild(itemToRemove);
            }
        }
    }
</script>

